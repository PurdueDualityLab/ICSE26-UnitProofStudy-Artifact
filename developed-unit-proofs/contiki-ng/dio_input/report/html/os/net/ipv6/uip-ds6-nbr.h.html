
<html>
<head>
<title>os/net/ipv6/uip-ds6-nbr.h</title>
<link rel="stylesheet" type="text/css" href="../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 /*</div><div id="2" class="line none">    2  * Copyright (c) 2013, Swedish Institute of Computer Science.</div><div id="3" class="line none">    3  * All rights reserved.</div><div id="4" class="line none">    4  *</div><div id="5" class="line none">    5  * Redistribution and use in source and binary forms, with or without</div><div id="6" class="line none">    6  * modification, are permitted provided that the following conditions</div><div id="7" class="line none">    7  * are met:</div><div id="8" class="line none">    8  * 1. Redistributions of source code must retain the above copyright</div><div id="9" class="line none">    9  *    notice, this list of conditions and the following disclaimer.</div><div id="10" class="line none">   10  * 2. Redistributions in binary form must reproduce the above copyright</div><div id="11" class="line none">   11  *    notice, this list of conditions and the following disclaimer in the</div><div id="12" class="line none">   12  *    documentation and/or other materials provided with the distribution.</div><div id="13" class="line none">   13  * 3. Neither the name of the Institute nor the names of its contributors</div><div id="14" class="line none">   14  *    may be used to endorse or promote products derived from this software</div><div id="15" class="line none">   15  *    without specific prior written permission.</div><div id="16" class="line none">   16  *</div><div id="17" class="line none">   17  * THIS SOFTWARE IS PROVIDED BY THE INSTITUTE AND CONTRIBUTORS ``AS IS'' AND</div><div id="18" class="line none">   18  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</div><div id="19" class="line none">   19  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</div><div id="20" class="line none">   20  * ARE DISCLAIMED.  IN NO EVENT SHALL THE INSTITUTE OR CONTRIBUTORS BE LIABLE</div><div id="21" class="line none">   21  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</div><div id="22" class="line none">   22  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS</div><div id="23" class="line none">   23  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</div><div id="24" class="line none">   24  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</div><div id="25" class="line none">   25  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</div><div id="26" class="line none">   26  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</div><div id="27" class="line none">   27  * SUCH DAMAGE.</div><div id="28" class="line none">   28  *</div><div id="29" class="line none">   29  *</div><div id="30" class="line none">   30  */</div><div id="31" class="line none">   31 </div><div id="32" class="line none">   32 /**</div><div id="33" class="line none">   33  * \addtogroup uip</div><div id="34" class="line none">   34  * @{</div><div id="35" class="line none">   35  */</div><div id="36" class="line none">   36 </div><div id="37" class="line none">   37 /**</div><div id="38" class="line none">   38  * \file</div><div id="39" class="line none">   39  *    IPv6 Neighbor cache (link-layer/IPv6 address mapping)</div><div id="40" class="line none">   40  * \author Mathilde Durvy &lt;mdurvy@cisco.com&gt;</div><div id="41" class="line none">   41  * \author Julien Abeille &lt;jabeille@cisco.com&gt;</div><div id="42" class="line none">   42  * \author Simon Duquennoy &lt;simonduq@sics.se&gt;</div><div id="43" class="line none">   43  *</div><div id="44" class="line none">   44  */</div><div id="45" class="line none">   45 </div><div id="46" class="line none">   46 #ifndef <a href="uip-ds6-nbr.h.html#47">UIP_DS6_NEIGHBOR_H_</a></div><div id="47" class="line none">   47 #define <a href="uip-ds6-nbr.h.html#47">UIP_DS6_NEIGHBOR_H_</a></div><div id="48" class="line none">   48 </div><div id="49" class="line none">   49 #include "contiki.h"</div><div id="50" class="line none">   50 #include "net/ipv6/uip.h"</div><div id="51" class="line none">   51 #include "net/ipv6/uip-nd6.h"</div><div id="52" class="line none">   52 #include "net/nbr-table.h"</div><div id="53" class="line none">   53 #include "sys/stimer.h"</div><div id="54" class="line none">   54 #if UIP_CONF_IPV6_QUEUE_PKT</div><div id="55" class="line none">   55 #include "net/ipv6/uip-packetqueue.h"</div><div id="56" class="line none">   56 #endif                          /*UIP_CONF_QUEUE_PKT */</div><div id="57" class="line none">   57 #if UIP_DS6_NBR_CONF_MULTI_IPV6_ADDRS</div><div id="58" class="line none">   58 #include "lib/assert.h"</div><div id="59" class="line none">   59 #include "lib/list.h"</div><div id="60" class="line none">   60 #endif</div><div id="61" class="line none">   61 </div><div id="62" class="line none">   62 /*--------------------------------------------------*/</div><div id="63" class="line none">   63 /** \brief Possible states for the nbr cache entries */</div><div id="64" class="line none">   64 #define  <a href="uip-ds6-nbr.h.html#64">NBR_INCOMPLETE</a> 0</div><div id="65" class="line none">   65 #define  <a href="uip-ds6-nbr.h.html#65">NBR_REACHABLE</a> 1</div><div id="66" class="line none">   66 #define  <a href="uip-ds6-nbr.h.html#66">NBR_STALE</a> 2</div><div id="67" class="line none">   67 #define  <a href="uip-ds6-nbr.h.html#67">NBR_DELAY</a> 3</div><div id="68" class="line none">   68 #define  <a href="uip-ds6-nbr.h.html#68">NBR_PROBE</a> 4</div><div id="69" class="line none">   69 </div><div id="70" class="line none">   70 /** \brief Set non-zero (1) to enable multiple IPv6 addresses to be</div><div id="71" class="line none">   71  * associated with a link-layer address */</div><div id="72" class="line none">   72 #ifdef UIP_DS6_NBR_CONF_MULTI_IPV6_ADDRS</div><div id="73" class="line none">   73 #define <a href="uip-ds6-nbr.h.html#73">UIP_DS6_NBR_MULTI_IPV6_ADDRS</a> UIP_DS6_NBR_CONF_MULTI_IPV6_ADDRS</div><div id="74" class="line none">   74 #else</div><div id="75" class="line none">   75 #define <a href="uip-ds6-nbr.h.html#73">UIP_DS6_NBR_MULTI_IPV6_ADDRS</a> 0</div><div id="76" class="line none">   76 #endif /* UIP_DS6_NBR_CONF_MULTI_IPV6_ADDRS */</div><div id="77" class="line none">   77 </div><div id="78" class="line none">   78 /** \brief Set the maximum number of IPv6 addresses per link-layer</div><div id="79" class="line none">   79  * address */</div><div id="80" class="line none">   80 #ifdef UIP_DS6_NBR_CONF_MAX_6ADDRS_PER_NBR</div><div id="81" class="line none">   81 #define <a href="uip-ds6-nbr.h.html#81">UIP_DS6_NBR_MAX_6ADDRS_PER_NBR</a> UIP_DS6_NBR_CONF_MAX_6ADDRS_PER_NBR</div><div id="82" class="line none">   82 #else</div><div id="83" class="line none">   83 #define <a href="uip-ds6-nbr.h.html#81">UIP_DS6_NBR_MAX_6ADDRS_PER_NBR</a> 2</div><div id="84" class="line none">   84 #endif /* UIP_DS6_NBR_CONF_MAX_6ADDRS_PER_NBR */</div><div id="85" class="line none">   85 </div><div id="86" class="line none">   86 /** \brief Set the maximum number of neighbor cache entries */</div><div id="87" class="line none">   87 #ifdef UIP_DS6_NBR_CONF_MAX_NEIGHBOR_CACHES</div><div id="88" class="line none">   88 #define <a href="uip-ds6-nbr.h.html#88">UIP_DS6_NBR_MAX_NEIGHBOR_CACHES</a> UIP_DS6_NBR_CONF_MAX_NEIGHBOR_CACHES</div><div id="89" class="line none">   89 #else</div><div id="90" class="line none">   90 #define <a href="uip-ds6-nbr.h.html#88">UIP_DS6_NBR_MAX_NEIGHBOR_CACHES</a> \</div><div id="91" class="line none">   91   (<a href="../nbr-table.h.html#56">NBR_TABLE_MAX_NEIGHBORS</a> * <a href="uip-ds6-nbr.h.html#81">UIP_DS6_NBR_MAX_6ADDRS_PER_NBR</a>)</div><div id="92" class="line none">   92 #endif /* UIP_DS6_NBR_CONF_MAX_NEIGHBOR_CACHES */</div><div id="93" class="line none">   93 </div><div id="94" class="line none">   94 #if <a href="uip-ds6-nbr.h.html#73">UIP_DS6_NBR_MULTI_IPV6_ADDRS</a></div><div id="95" class="line none">   95 /** \brief nbr_table entry when UIP_DS6_NBR_MULTI_IPV6_ADDRS is</div><div id="96" class="line none">   96  * enabled. uip_ds6_nbrs is a list of uip_ds6_nbr_t objects */</div><div id="97" class="line none">   97 typedef struct {</div><div id="98" class="line none">   98   <a href="../../lib/list.h.html#112">LIST_STRUCT</a>(uip_ds6_nbrs);</div><div id="99" class="line none">   99 } <a href="uip-ds6-nbr.h.html#99">uip_ds6_nbr_entry_t</a>;</div><div id="100" class="line none">  100 #endif /* UIP_DS6_NBR_MULTI_IPV6_ADDRS */</div><div id="101" class="line none">  101 </div><div id="102" class="line none">  102 /** \brief The default nbr_table entry (when</div><div id="103" class="line none">  103  * UIP_DS6_NBR_MULTI_IPV6_ADDRS is disabled), that implements nbr</div><div id="104" class="line none">  104  * cache */</div><div id="105" class="line none">  105 typedef struct <a href="uip-ds6-nbr.h.html#105">uip_ds6_nbr</a> {</div><div id="106" class="line none">  106 #if <a href="uip-ds6-nbr.h.html#73">UIP_DS6_NBR_MULTI_IPV6_ADDRS</a></div><div id="107" class="line none">  107   struct <a href="uip-ds6-nbr.h.html#105">uip_ds6_nbr</a> *<a href="../../lib/list.h.html#297">next</a>;</div><div id="108" class="line none">  108   <a href="uip-ds6-nbr.h.html#99">uip_ds6_nbr_entry_t</a> *<a href="uip-ds6-nbr.h.html#108">nbr_entry</a>;</div><div id="109" class="line none">  109 #endif /* UIP_DS6_NBR_MULTI_IPV6_ADDRS */</div><div id="110" class="line none">  110   <a href="uip.h.html#105">uip_ipaddr_t</a> <a href="uip-ds6-nbr.h.html#110">ipaddr</a>;</div><div id="111" class="line none">  111   uint8_t <a href="uip-ds6-nbr.h.html#111">isrouter</a>;</div><div id="112" class="line none">  112   uint8_t <a href="uip-ds6-nbr.h.html#112">state</a>;</div><div id="113" class="line none">  113 #if UIP_ND6_SEND_NS || UIP_ND6_SEND_RA</div><div id="114" class="line none">  114   struct <a href="../../sys/stimer.h.html#83">stimer</a> <a href="uip-ds6-nbr.h.html#114">reachable</a>;</div><div id="115" class="line none">  115   struct <a href="../../sys/stimer.h.html#83">stimer</a> <a href="uip-ds6-nbr.h.html#115">sendns</a>;</div><div id="116" class="line none">  116   uint8_t <a href="uip-ds6-nbr.h.html#116">nscount</a>;</div><div id="117" class="line none">  117 #endif /* UIP_ND6_SEND_NS || UIP_ND6_SEND_RA */</div><div id="118" class="line none">  118 #if UIP_CONF_IPV6_QUEUE_PKT</div><div id="119" class="line none">  119   struct <a href="uip-packetqueue.h.html#9">uip_packetqueue_handle</a> <a href="uip-ds6-nbr.h.html#119">packethandle</a>;</div><div id="120" class="line none">  120 #define <a href="uip-ds6-nbr.h.html#120">UIP_DS6_NBR_PACKET_LIFETIME</a> <a href="../../sys/clock.h.html#101">CLOCK_SECOND</a> * 4</div><div id="121" class="line none">  121 #endif                          /*UIP_CONF_QUEUE_PKT */</div><div id="122" class="line none">  122 } <a href="uip-ds6-nbr.h.html#122">uip_ds6_nbr_t</a>;</div><div id="123" class="line none">  123 </div><div id="124" class="line none">  124 void uip_ds6_neighbors_init(void);</div><div id="125" class="line none">  125 </div><div id="126" class="line none">  126 /**</div><div id="127" class="line none">  127  * Add a neighbor cache for a specified IPv6 address, which is</div><div id="128" class="line none">  128  *  associated with a specified link-layer address</div><div id="129" class="line none">  129  * \param ipaddr IPv6 address of a neighbor to add</div><div id="130" class="line none">  130  * \param lladdr Link-layer address to associate with ipaddr</div><div id="131" class="line none">  131  * \param isrouter Set 1 if the neighbor is a router</div><div id="132" class="line none">  132  * \param state Set the initial neighbor cache state (e.g.,</div><div id="133" class="line none">  133  * NBR_INCOMPLETE)</div><div id="134" class="line none">  134  * \param reason Set a reason of the addition (e.g.,</div><div id="135" class="line none">  135  * NBR_TABLE_REASON_RPL_DIO)</div><div id="136" class="line none">  136  * \param data Set data associated with the nbr cache</div><div id="137" class="line none">  137  * \return the address of a newly added nbr cache on success, NULL on</div><div id="138" class="line none">  138  * failure</div><div id="139" class="line none">  139  */</div><div id="140" class="line none">  140 <a href="uip-ds6-nbr.h.html#122">uip_ds6_nbr_t</a> *<a href="uip-ds6-nbr.h.html#140">uip_ds6_nbr_add</a>(const <a href="uip.h.html#105">uip_ipaddr_t</a> *<a href="uip-ds6-nbr.h.html#110">ipaddr</a>,</div><div id="141" class="line none">  141                                const <a href="uip.h.html#138">uip_lladdr_t</a> *<a href="../nbr-table.h.html#93">lladdr</a>,</div><div id="142" class="line none">  142                                uint8_t <a href="uip-ds6-nbr.h.html#111">isrouter</a>, uint8_t <a href="uip-ds6-nbr.h.html#112">state</a>,</div><div id="143" class="line none">  143                                <a href="../nbr-table.h.html#54">nbr_table_reason_t</a> reason, void *<a href="../nbr-table.h.html#87">data</a>);</div><div id="144" class="line none">  144 </div><div id="145" class="line none">  145 /**</div><div id="146" class="line none">  146  * Remove a neighbor cache</div><div id="147" class="line none">  147  * \param nbr the address of a neighbor cache to remove</div><div id="148" class="line none">  148  * \return 1 on success, 0 on failure (nothing was removed)</div><div id="149" class="line none">  149  */</div><div id="150" class="line none">  150 int uip_ds6_nbr_rm(<a href="uip-ds6-nbr.h.html#122">uip_ds6_nbr_t</a> *nbr);</div><div id="151" class="line none">  151 </div><div id="152" class="line none">  152 /**</div><div id="153" class="line none">  153  * Get the link-layer address associated with a specified nbr cache</div><div id="154" class="line none">  154  * \param nbr the address of a neighbor cache</div><div id="155" class="line none">  155  * \return pointer to the link-layer address on success, NULL on failure</div><div id="156" class="line none">  156  */</div><div id="157" class="line none">  157 const <a href="uip.h.html#138">uip_lladdr_t</a> *uip_ds6_nbr_get_ll(const <a href="uip-ds6-nbr.h.html#122">uip_ds6_nbr_t</a> *nbr);</div><div id="158" class="line none">  158 </div><div id="159" class="line none">  159 /**</div><div id="160" class="line none">  160  * Get the link-layer address associated with a specified IPv6 address</div><div id="161" class="line none">  161  * \param ipaddr an IPv6 address used as a search key</div><div id="162" class="line none">  162  * \return the pointer to the link-layer address on success, NULL on failure</div><div id="163" class="line none">  163  */</div><div id="164" class="line none">  164 const <a href="uip.h.html#138">uip_lladdr_t</a> *uip_ds6_nbr_lladdr_from_ipaddr(const <a href="uip.h.html#105">uip_ipaddr_t</a> *<a href="uip-ds6-nbr.h.html#110">ipaddr</a>);</div><div id="165" class="line none">  165 </div><div id="166" class="line none">  166 /**</div><div id="167" class="line none">  167  * Update the link-layer address associated with an  IPv6 address</div><div id="168" class="line none">  168  * \param nbr the double pointer to a neighbor cache which has the</div><div id="169" class="line none">  169  * target IPv6 address</div><div id="170" class="line none">  170  * \param new_ll_addr the new link-layer address of the IPv6 address</div><div id="171" class="line none">  171  * return 0 on success, -1 on failure</div><div id="172" class="line none">  172  */</div><div id="173" class="line none">  173 int uip_ds6_nbr_update_ll(<a href="uip-ds6-nbr.h.html#122">uip_ds6_nbr_t</a> **nbr, const <a href="uip.h.html#138">uip_lladdr_t</a> *new_ll_addr);</div><div id="174" class="line none">  174 </div><div id="175" class="line none">  175 /**</div><div id="176" class="line none">  176  * Get an IPv6 address of a neighbor cache</div><div id="177" class="line none">  177  * \param nbr the pointer to a neighbor cache</div><div id="178" class="line none">  178  * \return the pointer to an IPv6 address associated with the neighbor cache</div><div id="179" class="line none">  179  * \note This returns the first IPv6 address found in the neighbor</div><div id="180" class="line none">  180  * cache when UIP_DS6_NBR_MULTI_IPV6_ADDRS is enabled</div><div id="181" class="line none">  181  */</div><div id="182" class="line none">  182 const <a href="uip.h.html#105">uip_ipaddr_t</a> *uip_ds6_nbr_get_ipaddr(const <a href="uip-ds6-nbr.h.html#122">uip_ds6_nbr_t</a> *nbr);</div><div id="183" class="line none">  183 </div><div id="184" class="line none">  184 /**</div><div id="185" class="line none">  185  * Get an IPv6 address associated with a specified link-layer address</div><div id="186" class="line none">  186  * \param lladdr a link-layer address used as a search key</div><div id="187" class="line none">  187  * \return the pointer to an IPv6 address associated with the neighbor cache</div><div id="188" class="line none">  188  * \note This returns the first IPv6 address found in the neighbor</div><div id="189" class="line none">  189  * cache when UIP_DS6_NBR_MULTI_IPV6_ADDRS is enabled</div><div id="190" class="line none">  190  */</div><div id="191" class="line none">  191 <a href="uip.h.html#105">uip_ipaddr_t</a> *uip_ds6_nbr_ipaddr_from_lladdr(const <a href="uip.h.html#138">uip_lladdr_t</a> *<a href="../nbr-table.h.html#93">lladdr</a>);</div><div id="192" class="line none">  192 </div><div id="193" class="line none">  193 /**</div><div id="194" class="line none">  194  * Get the neighbor cache associated with a specified IPv6 address</div><div id="195" class="line none">  195  * \param ipaddr an IPv6 address used as a search key</div><div id="196" class="line none">  196  * \return the pointer to a neighbor cache on success, NULL on failure</div><div id="197" class="line none">  197  */</div><div id="198" class="line none">  198 <a href="uip-ds6-nbr.h.html#122">uip_ds6_nbr_t</a> *<a href="uip-ds6-nbr.h.html#198">uip_ds6_nbr_lookup</a>(const <a href="uip.h.html#105">uip_ipaddr_t</a> *<a href="uip-ds6-nbr.h.html#110">ipaddr</a>);</div><div id="199" class="line none">  199 </div><div id="200" class="line none">  200 /**</div><div id="201" class="line none">  201  * Get the neighbor cache associated with a specified link-layer address</div><div id="202" class="line none">  202  * \param lladdr a link-layer address used as a search key</div><div id="203" class="line none">  203  * \return the pointer to a neighbor cache on success, NULL on failure</div><div id="204" class="line none">  204  */</div><div id="205" class="line none">  205 <a href="uip-ds6-nbr.h.html#122">uip_ds6_nbr_t</a> *uip_ds6_nbr_ll_lookup(const <a href="uip.h.html#138">uip_lladdr_t</a> *<a href="../nbr-table.h.html#93">lladdr</a>);</div><div id="206" class="line none">  206 </div><div id="207" class="line none">  207 /**</div><div id="208" class="line none">  208  * Return the number of neighbor caches</div><div id="209" class="line none">  209  * \return the number of neighbor caches in use</div><div id="210" class="line none">  210  */</div><div id="211" class="line none">  211 int uip_ds6_nbr_num(void);</div><div id="212" class="line none">  212 </div><div id="213" class="line none">  213 /**</div><div id="214" class="line none">  214  * Get the first neighbor cache in nbr_table</div><div id="215" class="line none">  215  * \return the pointer to the first neighbor cache entry</div><div id="216" class="line none">  216  */</div><div id="217" class="line none">  217 <a href="uip-ds6-nbr.h.html#122">uip_ds6_nbr_t</a> *uip_ds6_nbr_head(void);</div><div id="218" class="line none">  218 </div><div id="219" class="line none">  219 /**</div><div id="220" class="line none">  220  * Get the next neighbor cache of a specified one</div><div id="221" class="line none">  221  * \param nbr the pointer to a neighbor cache</div><div id="222" class="line none">  222  * \return the pointer to the next one on success, NULL on failure</div><div id="223" class="line none">  223  */</div><div id="224" class="line none">  224 <a href="uip-ds6-nbr.h.html#122">uip_ds6_nbr_t</a> *uip_ds6_nbr_next(<a href="uip-ds6-nbr.h.html#122">uip_ds6_nbr_t</a> *nbr);</div><div id="225" class="line none">  225 </div><div id="226" class="line none">  226 /**</div><div id="227" class="line none">  227  * The callback function to update link-layer stats in a neighbor</div><div id="228" class="line none">  228  * cache</div><div id="229" class="line none">  229  * \param status MAC return value defined in mac.h</div><div id="230" class="line none">  230  * \param numtx the number of transmissions happened for a packet</div><div id="231" class="line none">  231  */</div><div id="232" class="line none">  232 void uip_ds6_link_callback(int status, int numtx);</div><div id="233" class="line none">  233 </div><div id="234" class="line none">  234 /**</div><div id="235" class="line none">  235  * The housekeeping function called periodically</div><div id="236" class="line none">  236  */</div><div id="237" class="line none">  237 void uip_ds6_neighbor_periodic(void);</div><div id="238" class="line none">  238 </div><div id="239" class="line none">  239 #if UIP_ND6_SEND_NS</div><div id="240" class="line none">  240 /**</div><div id="241" class="line none">  241  * \brief Refresh the reachable state of a neighbor. This function</div><div id="242" class="line none">  242  * may be called when a node receives an IPv6 message that confirms the</div><div id="243" class="line none">  243  * reachability of a neighbor.</div><div id="244" class="line none">  244  * \param ipaddr pointer to the IPv6 address whose neighbor reachability state</div><div id="245" class="line none">  245  * should be refreshed.</div><div id="246" class="line none">  246  */</div><div id="247" class="line none">  247 void uip_ds6_nbr_refresh_reachable_state(const <a href="uip.h.html#105">uip_ipaddr_t</a> *<a href="uip-ds6-nbr.h.html#110">ipaddr</a>);</div><div id="248" class="line none">  248 #endif /* UIP_ND6_SEND_NS */</div><div id="249" class="line none">  249 </div><div id="250" class="line none">  250 #endif /* UIP_DS6_NEIGHBOR_H_ */</div><div id="251" class="line none">  251 /** @} */</div>
</div>
</body>
</html>
