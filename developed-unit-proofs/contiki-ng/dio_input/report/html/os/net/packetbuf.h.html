
<html>
<head>
<title>os/net/packetbuf.h</title>
<link rel="stylesheet" type="text/css" href="../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 /*</div><div id="2" class="line none">    2  * Copyright (c) 2006, Swedish Institute of Computer Science.</div><div id="3" class="line none">    3  * All rights reserved.</div><div id="4" class="line none">    4  *</div><div id="5" class="line none">    5  * Redistribution and use in source and binary forms, with or without</div><div id="6" class="line none">    6  * modification, are permitted provided that the following conditions</div><div id="7" class="line none">    7  * are met:</div><div id="8" class="line none">    8  * 1. Redistributions of source code must retain the above copyright</div><div id="9" class="line none">    9  *    notice, this list of conditions and the following disclaimer.</div><div id="10" class="line none">   10  * 2. Redistributions in binary form must reproduce the above copyright</div><div id="11" class="line none">   11  *    notice, this list of conditions and the following disclaimer in the</div><div id="12" class="line none">   12  *    documentation and/or other materials provided with the distribution.</div><div id="13" class="line none">   13  * 3. Neither the name of the Institute nor the names of its contributors</div><div id="14" class="line none">   14  *    may be used to endorse or promote products derived from this software</div><div id="15" class="line none">   15  *    without specific prior written permission.</div><div id="16" class="line none">   16  *</div><div id="17" class="line none">   17  * THIS SOFTWARE IS PROVIDED BY THE INSTITUTE AND CONTRIBUTORS ``AS IS'' AND</div><div id="18" class="line none">   18  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</div><div id="19" class="line none">   19  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</div><div id="20" class="line none">   20  * ARE DISCLAIMED.  IN NO EVENT SHALL THE INSTITUTE OR CONTRIBUTORS BE LIABLE</div><div id="21" class="line none">   21  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</div><div id="22" class="line none">   22  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS</div><div id="23" class="line none">   23  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</div><div id="24" class="line none">   24  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</div><div id="25" class="line none">   25  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</div><div id="26" class="line none">   26  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</div><div id="27" class="line none">   27  * SUCH DAMAGE.</div><div id="28" class="line none">   28  *</div><div id="29" class="line none">   29  * This file is part of the Contiki operating system.</div><div id="30" class="line none">   30  *</div><div id="31" class="line none">   31  */</div><div id="32" class="line none">   32 </div><div id="33" class="line none">   33 /**</div><div id="34" class="line none">   34  * \file</div><div id="35" class="line none">   35  *         Header file for the Packet buffer (packetbuf) management</div><div id="36" class="line none">   36  * \author</div><div id="37" class="line none">   37  *         Adam Dunkels &lt;adam@sics.se&gt;</div><div id="38" class="line none">   38  */</div><div id="39" class="line none">   39 </div><div id="40" class="line none">   40 /**</div><div id="41" class="line none">   41  * \addtogroup net</div><div id="42" class="line none">   42  * @{</div><div id="43" class="line none">   43  */</div><div id="44" class="line none">   44 </div><div id="45" class="line none">   45 /**</div><div id="46" class="line none">   46  * \defgroup packetbuf Packet buffer</div><div id="47" class="line none">   47  * @{</div><div id="48" class="line none">   48  *</div><div id="49" class="line none">   49  * The packetbuf module does Contiki's buffer management.</div><div id="50" class="line none">   50  */</div><div id="51" class="line none">   51 </div><div id="52" class="line none">   52 #ifndef <a href="packetbuf.h.html#53">PACKETBUF_H_</a></div><div id="53" class="line none">   53 #define <a href="packetbuf.h.html#53">PACKETBUF_H_</a></div><div id="54" class="line none">   54 </div><div id="55" class="line none">   55 #include "contiki.h"</div><div id="56" class="line none">   56 #include "net/linkaddr.h"</div><div id="57" class="line none">   57 #include "net/mac/llsec802154.h"</div><div id="58" class="line none">   58 #include "net/mac/csma/csma-security.h"</div><div id="59" class="line none">   59 #include "net/mac/tsch/tsch-conf.h"</div><div id="60" class="line none">   60 </div><div id="61" class="line none">   61 /**</div><div id="62" class="line none">   62  * \brief      The size of the packetbuf, in bytes</div><div id="63" class="line none">   63  */</div><div id="64" class="line none">   64 #ifdef PACKETBUF_CONF_SIZE</div><div id="65" class="line none">   65 #define <a href="packetbuf.h.html#65">PACKETBUF_SIZE</a> PACKETBUF_CONF_SIZE</div><div id="66" class="line none">   66 #else</div><div id="67" class="line none">   67 #define <a href="packetbuf.h.html#65">PACKETBUF_SIZE</a> 128</div><div id="68" class="line none">   68 #endif</div><div id="69" class="line none">   69 </div><div id="70" class="line none">   70 /**</div><div id="71" class="line none">   71  * \brief      Clear and reset the packetbuf</div><div id="72" class="line none">   72  *</div><div id="73" class="line none">   73  *             This function clears the packetbuf and resets all</div><div id="74" class="line none">   74  *             internal state pointers (header size, header pointer,</div><div id="75" class="line none">   75  *             external data pointer). It is used before preparing a</div><div id="76" class="line none">   76  *             packet in the packetbuf.</div><div id="77" class="line none">   77  *</div><div id="78" class="line none">   78  */</div><div id="79" class="line none">   79 void packetbuf_clear(void);</div><div id="80" class="line none">   80 </div><div id="81" class="line none">   81 /**</div><div id="82" class="line none">   82  * \brief      Get a pointer to the data in the packetbuf</div><div id="83" class="line none">   83  * \return     Pointer to the packetbuf data</div><div id="84" class="line none">   84  *</div><div id="85" class="line none">   85  *             This function is used to get a pointer to the data in</div><div id="86" class="line none">   86  *             the packetbuf. The data is either stored in the packetbuf,</div><div id="87" class="line none">   87  *             or referenced to an external location.</div><div id="88" class="line none">   88  *</div><div id="89" class="line none">   89  */</div><div id="90" class="line none">   90 void *packetbuf_dataptr(void);</div><div id="91" class="line none">   91 </div><div id="92" class="line none">   92 /**</div><div id="93" class="line none">   93  * \brief      Get a pointer to the header in the packetbuf, for outbound packets</div><div id="94" class="line none">   94  * \return     Pointer to the packetbuf header</div><div id="95" class="line none">   95  *</div><div id="96" class="line none">   96  */</div><div id="97" class="line none">   97 void *packetbuf_hdrptr(void);</div><div id="98" class="line none">   98 </div><div id="99" class="line none">   99 /**</div><div id="100" class="line none">  100  * \brief      Get the length of the header in the packetbuf</div><div id="101" class="line none">  101  * \return     Length of the header in the packetbuf</div><div id="102" class="line none">  102  *</div><div id="103" class="line none">  103  */</div><div id="104" class="line none">  104 uint8_t packetbuf_hdrlen(void);</div><div id="105" class="line none">  105 </div><div id="106" class="line none">  106 </div><div id="107" class="line none">  107 /**</div><div id="108" class="line none">  108  * \brief      Get the length of the data in the packetbuf</div><div id="109" class="line none">  109  * \return     Length of the data in the packetbuf</div><div id="110" class="line none">  110  *</div><div id="111" class="line none">  111  */</div><div id="112" class="line none">  112 uint16_t packetbuf_datalen(void);</div><div id="113" class="line none">  113 </div><div id="114" class="line none">  114 /**</div><div id="115" class="line none">  115  * \brief      Get the total length of the header and data in the packetbuf</div><div id="116" class="line none">  116  * \return     Length of data and header in the packetbuf</div><div id="117" class="line none">  117  *</div><div id="118" class="line none">  118  */</div><div id="119" class="line none">  119 uint16_t packetbuf_totlen(void);</div><div id="120" class="line none">  120 </div><div id="121" class="line none">  121 /**</div><div id="122" class="line none">  122  * \brief      Get the total length of the remaining space in the packetbuf</div><div id="123" class="line none">  123  * \return     Length of the remaining space in the packetbuf</div><div id="124" class="line none">  124  *</div><div id="125" class="line none">  125  */</div><div id="126" class="line none">  126 uint16_t packetbuf_remaininglen(void);</div><div id="127" class="line none">  127 </div><div id="128" class="line none">  128 /**</div><div id="129" class="line none">  129  * \brief      Set the length of the data in the packetbuf</div><div id="130" class="line none">  130  * \param len  The length of the data</div><div id="131" class="line none">  131  */</div><div id="132" class="line none">  132 void packetbuf_set_datalen(uint16_t <a href="ipv6/uip.h.html#1268">len</a>);</div><div id="133" class="line none">  133 </div><div id="134" class="line none">  134 /**</div><div id="135" class="line none">  135  * \brief      Copy from external data into the packetbuf</div><div id="136" class="line none">  136  * \param from A pointer to the data from which to copy</div><div id="137" class="line none">  137  * \param len  The size of the data to copy</div><div id="138" class="line none">  138  * \retval     The number of bytes that was copied into the packetbuf</div><div id="139" class="line none">  139  *</div><div id="140" class="line none">  140  *             This function copies data from a pointer into the</div><div id="141" class="line none">  141  *             packetbuf. If the data that is to be copied is larger</div><div id="142" class="line none">  142  *             than the packetbuf, only the data that fits in the</div><div id="143" class="line none">  143  *             packetbuf is copied. The number of bytes that could be</div><div id="144" class="line none">  144  *             copied into the rimbuf is returned.</div><div id="145" class="line none">  145  *</div><div id="146" class="line none">  146  */</div><div id="147" class="line none">  147 int <a href="packetbuf.h.html#147">packetbuf_copyfrom</a>(const void *from, uint16_t <a href="ipv6/uip.h.html#1268">len</a>);</div><div id="148" class="line none">  148 </div><div id="149" class="line none">  149 /**</div><div id="150" class="line none">  150  * \brief      Copy the entire packetbuf to an external buffer</div><div id="151" class="line none">  151  * \param to   A pointer to the buffer to which the data is to be copied</div><div id="152" class="line none">  152  * \retval     The number of bytes that was copied to the external buffer</div><div id="153" class="line none">  153  *</div><div id="154" class="line none">  154  *             This function copies the packetbuf to an external</div><div id="155" class="line none">  155  *             buffer. Both the data portion and the header portion of</div><div id="156" class="line none">  156  *             the packetbuf is copied.</div><div id="157" class="line none">  157  *</div><div id="158" class="line none">  158  *             The external buffer to which the packetbuf is to be</div><div id="159" class="line none">  159  *             copied must be able to accomodate at least</div><div id="160" class="line none">  160  *             PACKETBUF_SIZE bytes. The number of</div><div id="161" class="line none">  161  *             bytes that was copied to the external buffer is</div><div id="162" class="line none">  162  *             returned.</div><div id="163" class="line none">  163  *</div><div id="164" class="line none">  164  */</div><div id="165" class="line none">  165 int packetbuf_copyto(void *to);</div><div id="166" class="line none">  166 </div><div id="167" class="line none">  167 /**</div><div id="168" class="line none">  168  * \brief      Extend the header of the packetbuf, for outbound packets</div><div id="169" class="line none">  169  * \param size The number of bytes the header should be extended</div><div id="170" class="line none">  170  * \retval     Non-zero if the header could be extended, zero otherwise</div><div id="171" class="line none">  171  *</div><div id="172" class="line none">  172  *             This function is used to allocate extra space in the</div><div id="173" class="line none">  173  *             header portion in the packetbuf, when preparing outbound</div><div id="174" class="line none">  174  *             packets for transmission. If the function is unable to</div><div id="175" class="line none">  175  *             allocate sufficient header space, the function returns</div><div id="176" class="line none">  176  *             zero and does not allocate anything.</div><div id="177" class="line none">  177  *</div><div id="178" class="line none">  178  */</div><div id="179" class="line none">  179 int packetbuf_hdralloc(int size);</div><div id="180" class="line none">  180 </div><div id="181" class="line none">  181 /**</div><div id="182" class="line none">  182  * \brief      Reduce the header in the packetbuf, for incoming packets</div><div id="183" class="line none">  183  * \param size The number of bytes the header should be reduced</div><div id="184" class="line none">  184  * \retval     Non-zero if the header could be reduced, zero otherwise</div><div id="185" class="line none">  185  *</div><div id="186" class="line none">  186  *             This function is used to remove the first part of the</div><div id="187" class="line none">  187  *             header in the packetbuf, when processing incoming</div><div id="188" class="line none">  188  *             packets. If the function is unable to remove the</div><div id="189" class="line none">  189  *             requested amount of header space, the function returns</div><div id="190" class="line none">  190  *             zero and does not allocate anything.</div><div id="191" class="line none">  191  *</div><div id="192" class="line none">  192  */</div><div id="193" class="line none">  193 int packetbuf_hdrreduce(int size);</div><div id="194" class="line none">  194 </div><div id="195" class="line none">  195 /* Packet attributes stuff below: */</div><div id="196" class="line none">  196 </div><div id="197" class="line none">  197 typedef uint16_t <a href="packetbuf.h.html#197">packetbuf_attr_t</a>;</div><div id="198" class="line none">  198 </div><div id="199" class="line none">  199 struct <a href="packetbuf.h.html#199">packetbuf_attr</a> {</div><div id="200" class="line none">  200   <a href="packetbuf.h.html#197">packetbuf_attr_t</a> <a href="packetbuf.h.html#200">val</a>;</div><div id="201" class="line none">  201 };</div><div id="202" class="line none">  202 struct <a href="packetbuf.h.html#258">packetbuf_addr</a> {</div><div id="203" class="line none">  203   <a href="linkaddr.h.html#71">linkaddr_t</a> <a href="ipv6/uip.h.html#113">addr</a>;</div><div id="204" class="line none">  204 };</div><div id="205" class="line none">  205 </div><div id="206" class="line none">  206 enum {</div><div id="207" class="line none">  207   <a href="packetbuf.h.html#207">PACKETBUF_ATTR_NONE</a>,</div><div id="208" class="line none">  208 </div><div id="209" class="line none">  209   /* Scope 0 attributes: used only on the local node. */</div><div id="210" class="line none">  210   <a href="packetbuf.h.html#210">PACKETBUF_ATTR_CHANNEL</a>,</div><div id="211" class="line none">  211   <a href="packetbuf.h.html#211">PACKETBUF_ATTR_NETWORK_ID</a>,</div><div id="212" class="line none">  212   <a href="packetbuf.h.html#212">PACKETBUF_ATTR_LINK_QUALITY</a>,</div><div id="213" class="line none">  213   <a href="packetbuf.h.html#213">PACKETBUF_ATTR_RSSI</a>,</div><div id="214" class="line none">  214   <a href="packetbuf.h.html#214">PACKETBUF_ATTR_MAX_MAC_TRANSMISSIONS</a>,</div><div id="215" class="line none">  215   <a href="packetbuf.h.html#215">PACKETBUF_ATTR_MAC_SEQNO</a>,</div><div id="216" class="line none">  216   <a href="packetbuf.h.html#216">PACKETBUF_ATTR_MAC_ACK</a>,</div><div id="217" class="line none">  217   <a href="packetbuf.h.html#217">PACKETBUF_ATTR_MAC_METADATA</a>,</div><div id="218" class="line none">  218   <a href="packetbuf.h.html#218">PACKETBUF_ATTR_MAC_NO_SRC_ADDR</a>,</div><div id="219" class="line none">  219   <a href="packetbuf.h.html#219">PACKETBUF_ATTR_MAC_NO_DEST_ADDR</a>,</div><div id="220" class="line none">  220 #if TSCH_WITH_LINK_SELECTOR</div><div id="221" class="line none">  221   <a href="packetbuf.h.html#221">PACKETBUF_ATTR_TSCH_SLOTFRAME</a>,</div><div id="222" class="line none">  222   <a href="packetbuf.h.html#222">PACKETBUF_ATTR_TSCH_TIMESLOT</a>,</div><div id="223" class="line none">  223   <a href="packetbuf.h.html#223">PACKETBUF_ATTR_TSCH_CHANNEL_OFFSET</a>,</div><div id="224" class="line none">  224 #endif /* TSCH_WITH_LINK_SELECTOR */</div><div id="225" class="line none">  225 </div><div id="226" class="line none">  226   /* Scope 1 attributes: used between two neighbors only. */</div><div id="227" class="line none">  227   <a href="packetbuf.h.html#227">PACKETBUF_ATTR_FRAME_TYPE</a>,</div><div id="228" class="line none">  228 #if LLSEC802154_USES_AUX_HEADER</div><div id="229" class="line none">  229   <a href="packetbuf.h.html#229">PACKETBUF_ATTR_SECURITY_LEVEL</a>,</div><div id="230" class="line none">  230 #endif /* LLSEC802154_USES_AUX_HEADER */</div><div id="231" class="line none">  231 #if LLSEC802154_USES_EXPLICIT_KEYS</div><div id="232" class="line none">  232   <a href="packetbuf.h.html#232">PACKETBUF_ATTR_KEY_ID_MODE</a>,</div><div id="233" class="line none">  233   <a href="packetbuf.h.html#233">PACKETBUF_ATTR_KEY_INDEX</a>,</div><div id="234" class="line none">  234 #endif /* LLSEC802154_USES_EXPLICIT_KEYS */</div><div id="235" class="line none">  235 </div><div id="236" class="line none">  236 #if LLSEC802154_USES_FRAME_COUNTER</div><div id="237" class="line none">  237   <a href="packetbuf.h.html#237">PACKETBUF_ATTR_FRAME_COUNTER_BYTES_0_1</a>,</div><div id="238" class="line none">  238   <a href="packetbuf.h.html#238">PACKETBUF_ATTR_FRAME_COUNTER_BYTES_2_3</a>,</div><div id="239" class="line none">  239 #endif /* LLSEC802154_USES_FRAME_COUNTER */</div><div id="240" class="line none">  240 </div><div id="241" class="line none">  241   /* Scope 2 attributes: used between end-to-end nodes. */</div><div id="242" class="line none">  242   /* These must be last */</div><div id="243" class="line none">  243   <a href="packetbuf.h.html#243">PACKETBUF_ADDR_SENDER</a>,</div><div id="244" class="line none">  244   <a href="packetbuf.h.html#244">PACKETBUF_ADDR_RECEIVER</a>,</div><div id="245" class="line none">  245 </div><div id="246" class="line none">  246   <a href="packetbuf.h.html#246">PACKETBUF_ATTR_MAX</a></div><div id="247" class="line none">  247 };</div><div id="248" class="line none">  248 </div><div id="249" class="line none">  249 #define <a href="packetbuf.h.html#249">PACKETBUF_NUM_ADDRS</a> 2</div><div id="250" class="line none">  250 #define <a href="packetbuf.h.html#250">PACKETBUF_NUM_ATTRS</a> (<a href="packetbuf.h.html#246">PACKETBUF_ATTR_MAX</a> - <a href="packetbuf.h.html#249">PACKETBUF_NUM_ADDRS</a>)</div><div id="251" class="line none">  251 #define <a href="packetbuf.h.html#251">PACKETBUF_ADDR_FIRST</a> <a href="packetbuf.h.html#243">PACKETBUF_ADDR_SENDER</a></div><div id="252" class="line none">  252 </div><div id="253" class="line none">  253 #define <a href="packetbuf.h.html#253">PACKETBUF_IS_ADDR</a>(<a href="ipv6/uip-ds6.h.html#209">type</a>) ((<a href="ipv6/uip-ds6.h.html#209">type</a>) &gt;= <a href="packetbuf.h.html#251">PACKETBUF_ADDR_FIRST</a>)</div><div id="254" class="line none">  254 </div><div id="255" class="line none">  255 void              packetbuf_set_attr(uint8_t <a href="ipv6/uip-ds6.h.html#209">type</a>, const <a href="packetbuf.h.html#197">packetbuf_attr_t</a> <a href="packetbuf.h.html#200">val</a>);</div><div id="256" class="line none">  256 <a href="packetbuf.h.html#197">packetbuf_attr_t</a> <a href="packetbuf.h.html#199">packetbuf_attr</a>(uint8_t <a href="ipv6/uip-ds6.h.html#209">type</a>);</div><div id="257" class="line none">  257 void              packetbuf_set_addr(uint8_t <a href="ipv6/uip-ds6.h.html#209">type</a>, const <a href="linkaddr.h.html#71">linkaddr_t</a> *<a href="ipv6/uip.h.html#113">addr</a>);</div><div id="258" class="line none">  258 const <a href="linkaddr.h.html#71">linkaddr_t</a> *<a href="packetbuf.h.html#258">packetbuf_addr</a>(uint8_t <a href="ipv6/uip-ds6.h.html#209">type</a>);</div><div id="259" class="line none">  259 </div><div id="260" class="line none">  260 /**</div><div id="261" class="line none">  261  * \brief       Checks whether the current packet is a broadcast.</div><div id="262" class="line none">  262  * \retval true iff the current packet is a broadcast</div><div id="263" class="line none">  263  */</div><div id="264" class="line none">  264 bool              packetbuf_holds_broadcast(void);</div><div id="265" class="line none">  265 </div><div id="266" class="line none">  266 void              packetbuf_attr_clear(void);</div><div id="267" class="line none">  267 </div><div id="268" class="line none">  268 void              packetbuf_attr_copyto(struct <a href="packetbuf.h.html#199">packetbuf_attr</a> *attrs,</div><div id="269" class="line none">  269                                         struct <a href="packetbuf.h.html#258">packetbuf_addr</a> *addrs);</div><div id="270" class="line none">  270 void              packetbuf_attr_copyfrom(struct <a href="packetbuf.h.html#199">packetbuf_attr</a> *attrs,</div><div id="271" class="line none">  271                                           struct <a href="packetbuf.h.html#258">packetbuf_addr</a> *addrs);</div><div id="272" class="line none">  272 </div><div id="273" class="line none">  273 #define <a href="packetbuf.h.html#273">PACKETBUF_ATTRIBUTES</a>(...) { __VA_ARGS__ <a href="packetbuf.h.html#274">PACKETBUF_ATTR_LAST</a> }</div><div id="274" class="line none">  274 #define <a href="packetbuf.h.html#274">PACKETBUF_ATTR_LAST</a> { <a href="packetbuf.h.html#207">PACKETBUF_ATTR_NONE</a>, 0 }</div><div id="275" class="line none">  275 </div><div id="276" class="line none">  276 #define <a href="packetbuf.h.html#276">PACKETBUF_ATTR_BIT</a>  1</div><div id="277" class="line none">  277 #define <a href="packetbuf.h.html#277">PACKETBUF_ATTR_BYTE</a> 8</div><div id="278" class="line none">  278 #define <a href="packetbuf.h.html#278">PACKETBUF_ADDRSIZE</a> (<a href="linkaddr.h.html#59">LINKADDR_SIZE</a> * <a href="packetbuf.h.html#277">PACKETBUF_ATTR_BYTE</a>)</div><div id="279" class="line none">  279 </div><div id="280" class="line none">  280 #define <a href="packetbuf.h.html#280">PACKETBUF_ATTR_SECURITY_LEVEL_DEFAULT</a> 0xffff</div><div id="281" class="line none">  281 </div><div id="282" class="line none">  282 struct <a href="packetbuf.h.html#282">packetbuf_attrlist</a> {</div><div id="283" class="line none">  283   uint8_t <a href="ipv6/uip-ds6.h.html#209">type</a>;</div><div id="284" class="line none">  284   uint8_t <a href="ipv6/uip.h.html#1268">len</a>;</div><div id="285" class="line none">  285 };</div><div id="286" class="line none">  286 </div><div id="287" class="line none">  287 #endif /* PACKETBUF_H_ */</div><div id="288" class="line none">  288 /** @} */</div><div id="289" class="line none">  289 /** @} */</div>
</div>
</body>
</html>
