
<html>
<head>
<title>cbmc/include/gnet/packetbuf-generic.h</title>
<link rel="stylesheet" type="text/css" href="../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 /**</div><div id="2" class="line none">    2  * @file packetbuf-generic.h</div><div id="3" class="line none">    3  * @author Owen Cochell (owencochell@gmail.com)</div><div id="4" class="line none">    4  * @brief Generic tools for initializing packetbuf</div><div id="5" class="line none">    5  * @version 0.1</div><div id="6" class="line none">    6  * @date 2024-06-24</div><div id="7" class="line none">    7  * </div><div id="8" class="line none">    8  * @copyright Copyright (c) 2024</div><div id="9" class="line none">    9  * </div><div id="10" class="line none">   10  * This header contains methods for initializing packetbuf components,</div><div id="11" class="line none">   11  * and ensuring these components are in a valid state.</div><div id="12" class="line none">   12  * If not preformed, you may see errors related to invalid pointers and bad memory segments.</div><div id="13" class="line none">   13  */</div><div id="14" class="line none">   14 </div><div id="15" class="line none">   15 #include "contiki.h"</div><div id="16" class="line none">   16 #include "net/packetbuf.h"</div><div id="17" class="line none">   17 </div><div id="18" class="line none">   18 /// Link in packetbuf pointer (static keyword removed!)</div><div id="19" class="line none">   19 extern uint8_t <a href="packetbuf-generic.h.html#19">packetbuf</a>[<a href="../../../os/net/packetbuf.h.html#65">PACKETBUF_SIZE</a>];</div><div id="20" class="line none">   20 </div><div id="21" class="line none">   21 /**</div><div id="22" class="line none">   22  * @brief Initializes the packetbuf pointer</div><div id="23" class="line none">   23  * </div><div id="24" class="line none">   24  * We preform the following:</div><div id="25" class="line none">   25  * - Ensure packetbuf pointer is not NULL</div><div id="26" class="line none">   26  * - Ensure packetbuf pointer is readable and writable for maximum size</div><div id="27" class="line none">   27  * - Write unbounded contents to packetbuf - will not exceed max size</div><div id="28" class="line none">   28  * </div><div id="29" class="line none">   29  * This function does not preform any operations on the pointer,</div><div id="30" class="line none">   30  * it only asks CBMC to make some sane assumptions about the packetbuf pointer.</div><div id="31" class="line none">   31  * </div><div id="32" class="line none">   32  * We return the size of the data in the packetbuf.</div><div id="33" class="line none">   33  */</div><div id="34" class="line none">   34 uint16_t <a href="packetbuf-generic.h.html#34">init_packetbuf</a>() {</div><div id="35" class="line none">   35 </div><div id="36" class="line none">   36     // Ensure packet pointer is not NULL:</div><div id="37" class="line none">   37 </div><div id="38" class="line none">   38     __CPROVER_assume(<a href="packetbuf-generic.h.html#19">packetbuf</a> != NULL);</div><div id="39" class="line none">   39 </div><div id="40" class="line none">   40     // Ensure memory is valid:</div><div id="41" class="line none">   41 </div><div id="42" class="line none">   42     __CPROVER_assume(__CPROVER_rw_ok(<a href="packetbuf-generic.h.html#19">packetbuf</a>, <a href="../../../os/net/packetbuf.h.html#65">PACKETBUF_SIZE</a>));</div><div id="43" class="line none">   43 </div><div id="44" class="line none">   44     // Determine size of data to write:</div><div id="45" class="line none">   45 </div><div id="46" class="line none">   46     const uint16_t psize;</div><div id="47" class="line none">   47 </div><div id="48" class="line none">   48     // Ensure size does not exceed max:</div><div id="49" class="line none">   49 </div><div id="50" class="line none">   50     __CPROVER_assume(psize &lt;= <a href="../../../os/net/packetbuf.h.html#65">PACKETBUF_SIZE</a>);</div><div id="51" class="line none">   51 </div><div id="52" class="line none">   52     // Allocate data:</div><div id="53" class="line none">   53 </div><div id="54" class="line none">   54     uint8_t *tdata = (uint8_t *)<a href="packetbuf-generic.h.html#54">malloc</a>(sizeof(uint8_t) * psize);</div><div id="55" class="line none">   55 </div><div id="56" class="line none">   56     // Ensure data is not NULL:</div><div id="57" class="line none">   57 </div><div id="58" class="line none">   58     __CPROVER_assume(tdata != NULL);</div><div id="59" class="line none">   59 </div><div id="60" class="line none">   60     // Ensure data is valid:</div><div id="61" class="line none">   61 </div><div id="62" class="line none">   62     __CPROVER_assume(__CPROVER_rw_ok(tdata, psize));</div><div id="63" class="line none">   63 </div><div id="64" class="line none">   64     // Copy data into packetbuf:</div><div id="65" class="line none">   65 </div><div id="66" class="line none">   66     <a href="../../../os/net/packetbuf.h.html#147">packetbuf_copyfrom</a>(tdata, psize);</div><div id="67" class="line none">   67 </div><div id="68" class="line none">   68     // Ensure packet pointer is not NULL:</div><div id="69" class="line none">   69 </div><div id="70" class="line none">   70     __CPROVER_assume(<a href="packetbuf-generic.h.html#19">packetbuf</a> != NULL);</div><div id="71" class="line none">   71 </div><div id="72" class="line none">   72     // Ensure memory is valid:</div><div id="73" class="line none">   73 </div><div id="74" class="line none">   74     __CPROVER_assume(__CPROVER_rw_ok(<a href="packetbuf-generic.h.html#19">packetbuf</a>, <a href="../../../os/net/packetbuf.h.html#65">PACKETBUF_SIZE</a>));</div><div id="75" class="line none">   75 </div><div id="76" class="line none">   76     return psize;</div><div id="77" class="line none">   77 }</div>
</div>
</body>
</html>
