
<html>
<head>
<title>os/sys/ctimer.h</title>
<link rel="stylesheet" type="text/css" href="../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 /*</div><div id="2" class="line none">    2  * Copyright (c) 2006, Swedish Institute of Computer Science.</div><div id="3" class="line none">    3  * All rights reserved.</div><div id="4" class="line none">    4  *</div><div id="5" class="line none">    5  * Redistribution and use in source and binary forms, with or without</div><div id="6" class="line none">    6  * modification, are permitted provided that the following conditions</div><div id="7" class="line none">    7  * are met:</div><div id="8" class="line none">    8  * 1. Redistributions of source code must retain the above copyright</div><div id="9" class="line none">    9  *    notice, this list of conditions and the following disclaimer.</div><div id="10" class="line none">   10  * 2. Redistributions in binary form must reproduce the above copyright</div><div id="11" class="line none">   11  *    notice, this list of conditions and the following disclaimer in the</div><div id="12" class="line none">   12  *    documentation and/or other materials provided with the distribution.</div><div id="13" class="line none">   13  * 3. Neither the name of the Institute nor the names of its contributors</div><div id="14" class="line none">   14  *    may be used to endorse or promote products derived from this software</div><div id="15" class="line none">   15  *    without specific prior written permission.</div><div id="16" class="line none">   16  *</div><div id="17" class="line none">   17  * THIS SOFTWARE IS PROVIDED BY THE INSTITUTE AND CONTRIBUTORS ``AS IS'' AND</div><div id="18" class="line none">   18  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</div><div id="19" class="line none">   19  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</div><div id="20" class="line none">   20  * ARE DISCLAIMED.  IN NO EVENT SHALL THE INSTITUTE OR CONTRIBUTORS BE LIABLE</div><div id="21" class="line none">   21  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</div><div id="22" class="line none">   22  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS</div><div id="23" class="line none">   23  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</div><div id="24" class="line none">   24  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</div><div id="25" class="line none">   25  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</div><div id="26" class="line none">   26  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</div><div id="27" class="line none">   27  * SUCH DAMAGE.</div><div id="28" class="line none">   28  *</div><div id="29" class="line none">   29  * This file is part of the Contiki operating system.</div><div id="30" class="line none">   30  *</div><div id="31" class="line none">   31  */</div><div id="32" class="line none">   32 </div><div id="33" class="line none">   33 /**</div><div id="34" class="line none">   34  * \file</div><div id="35" class="line none">   35  *         Header file for the callback timer</div><div id="36" class="line none">   36  * \author</div><div id="37" class="line none">   37  *         Adam Dunkels &lt;adam@sics.se&gt;</div><div id="38" class="line none">   38  */</div><div id="39" class="line none">   39 </div><div id="40" class="line none">   40 /**</div><div id="41" class="line none">   41  * \addtogroup timers</div><div id="42" class="line none">   42  * @{</div><div id="43" class="line none">   43  */</div><div id="44" class="line none">   44 </div><div id="45" class="line none">   45 /**</div><div id="46" class="line none">   46  * \defgroup ctimer Callback timer</div><div id="47" class="line none">   47  * @{</div><div id="48" class="line none">   48  *</div><div id="49" class="line none">   49  * The ctimer module provides a timer mechanism that calls a specified</div><div id="50" class="line none">   50  * C function when a ctimer expires.</div><div id="51" class="line none">   51  *</div><div id="52" class="line none">   52  * It is \e not safe to manipulate callback timers within an interrupt context.</div><div id="53" class="line none">   53  */</div><div id="54" class="line none">   54 </div><div id="55" class="line none">   55 #ifndef <a href="ctimer.h.html#56">CTIMER_H_</a></div><div id="56" class="line none">   56 #define <a href="ctimer.h.html#56">CTIMER_H_</a></div><div id="57" class="line none">   57 </div><div id="58" class="line none">   58 #include "contiki.h"</div><div id="59" class="line none">   59 #include "sys/etimer.h"</div><div id="60" class="line none">   60 </div><div id="61" class="line none">   61 #include &lt;stdbool.h&gt;</div><div id="62" class="line none">   62 </div><div id="63" class="line none">   63 struct <a href="ctimer.h.html#63">ctimer</a> {</div><div id="64" class="line none">   64   struct <a href="ctimer.h.html#63">ctimer</a> *<a href="../net/ipv6/uip-ds6-nbr.h.html#107">next</a>;</div><div id="65" class="line none">   65   struct <a href="etimer.h.html#79">etimer</a> <a href="etimer.h.html#79">etimer</a>;</div><div id="66" class="line none">   66   struct <a href="process.h.html#316">process</a> *<a href="ctimer.h.html#66">p</a>;</div><div id="67" class="line none">   67   void (*<a href="ctimer.h.html#67">f</a>)(void *);</div><div id="68" class="line none">   68   void *<a href="ctimer.h.html#68">ptr</a>;</div><div id="69" class="line none">   69 };</div><div id="70" class="line none">   70 </div><div id="71" class="line none">   71 /**</div><div id="72" class="line none">   72  * \brief      Reset a callback timer with the same interval as was</div><div id="73" class="line none">   73  *             previously set.</div><div id="74" class="line none">   74  * \param c    A pointer to the callback timer.</div><div id="75" class="line none">   75  *</div><div id="76" class="line none">   76  *             This function resets the callback timer with the same</div><div id="77" class="line none">   77  *             interval that was given to the callback timer with the</div><div id="78" class="line none">   78  *             ctimer_set() function. The start point of the interval</div><div id="79" class="line none">   79  *             is the exact time that the callback timer last</div><div id="80" class="line none">   80  *             expired. Therefore, this function will cause the timer</div><div id="81" class="line none">   81  *             to be stable over time, unlike the ctimer_restart()</div><div id="82" class="line none">   82  *             function. If this is executed before the timer expired,</div><div id="83" class="line none">   83  *             this function has no effect.</div><div id="84" class="line none">   84  *</div><div id="85" class="line none">   85  * \sa ctimer_restart()</div><div id="86" class="line none">   86  */</div><div id="87" class="line none">   87 void ctimer_reset(struct <a href="ctimer.h.html#63">ctimer</a> *c);</div><div id="88" class="line none">   88 </div><div id="89" class="line none">   89 /**</div><div id="90" class="line none">   90  * \brief      Restart a callback timer from the current point in time</div><div id="91" class="line none">   91  * \param c    A pointer to the callback timer.</div><div id="92" class="line none">   92  *</div><div id="93" class="line none">   93  *             This function restarts the callback timer with the same</div><div id="94" class="line none">   94  *             interval that was given to the ctimer_set()</div><div id="95" class="line none">   95  *             function. The callback timer will start at the current</div><div id="96" class="line none">   96  *             time.</div><div id="97" class="line none">   97  *</div><div id="98" class="line none">   98  *             \note A periodic timer will drift if this function is</div><div id="99" class="line none">   99  *             used to reset it. For periodic timers, use the</div><div id="100" class="line none">  100  *             ctimer_reset() function instead.</div><div id="101" class="line none">  101  *</div><div id="102" class="line none">  102  * \sa ctimer_reset()</div><div id="103" class="line none">  103  */</div><div id="104" class="line none">  104 void ctimer_restart(struct <a href="ctimer.h.html#63">ctimer</a> *c);</div><div id="105" class="line none">  105 </div><div id="106" class="line none">  106 /**</div><div id="107" class="line none">  107  * \brief      Set a callback timer.</div><div id="108" class="line none">  108  * \param c    A pointer to the callback timer.</div><div id="109" class="line none">  109  * \param t    The interval before the timer expires.</div><div id="110" class="line none">  110  * \param f    A function to be called when the timer expires.</div><div id="111" class="line none">  111  * \param ptr  An opaque pointer that will be supplied as an argument to the callback function.</div><div id="112" class="line none">  112  * \param p    A pointer to the process the timer belongs to</div><div id="113" class="line none">  113  *</div><div id="114" class="line none">  114  *             This function is used to set a callback timer for a time</div><div id="115" class="line none">  115  *             sometime in the future. When the callback timer expires,</div><div id="116" class="line none">  116  *             the callback function f will be called with ptr as argument.</div><div id="117" class="line none">  117  *</div><div id="118" class="line none">  118  */</div><div id="119" class="line none">  119 void ctimer_set_with_process(struct <a href="ctimer.h.html#63">ctimer</a> *c, <a href="clock.h.html#87">clock_time_t</a> t,</div><div id="120" class="line none">  120                              void (*<a href="ctimer.h.html#67">f</a>)(void *), void *<a href="ctimer.h.html#68">ptr</a>, struct <a href="process.h.html#316">process</a> *<a href="ctimer.h.html#66">p</a>);</div><div id="121" class="line none">  121 </div><div id="122" class="line none">  122 /**</div><div id="123" class="line none">  123  * \brief      Set a callback timer.</div><div id="124" class="line none">  124  * \param c    A pointer to the callback timer.</div><div id="125" class="line none">  125  * \param t    The interval before the timer expires.</div><div id="126" class="line none">  126  * \param f    A function to be called when the timer expires.</div><div id="127" class="line none">  127  * \param ptr  An opaque pointer that will be supplied as an argument to the callback function.</div><div id="128" class="line none">  128  *</div><div id="129" class="line none">  129  *             This function is used to set a callback timer for a time</div><div id="130" class="line none">  130  *             sometime in the future. When the callback timer expires,</div><div id="131" class="line none">  131  *             the callback function f will be called with ptr as argument.</div><div id="132" class="line none">  132  *</div><div id="133" class="line none">  133  *             This essentially does ctimer_set_process(c, t, f, ptr, PROCESS_CURRENT());</div><div id="134" class="line none">  134  *</div><div id="135" class="line none">  135  */</div><div id="136" class="line none">  136 static inline void</div><div id="137" class="line none">  137 <a href="ctimer.h.html#137">ctimer_set</a>(struct <a href="ctimer.h.html#63">ctimer</a> *c, <a href="clock.h.html#87">clock_time_t</a> t, void (*<a href="ctimer.h.html#67">f</a>)(void *), void *<a href="ctimer.h.html#68">ptr</a>)</div><div id="138" class="line none">  138 {</div><div id="139" class="line none">  139   ctimer_set_with_process(c, t, <a href="ctimer.h.html#67">f</a>, <a href="ctimer.h.html#68">ptr</a>, <a href="process.h.html#404">PROCESS_CURRENT</a>());</div><div id="140" class="line none">  140 }</div><div id="141" class="line none">  141 </div><div id="142" class="line none">  142 /**</div><div id="143" class="line none">  143  * \brief      Stop a pending callback timer.</div><div id="144" class="line none">  144  * \param c    A pointer to the pending callback timer.</div><div id="145" class="line none">  145  *</div><div id="146" class="line none">  146  *             This function stops a callback timer that has previously</div><div id="147" class="line none">  147  *             been set with ctimer_set(), ctimer_reset(), or ctimer_restart().</div><div id="148" class="line none">  148  *             After this function has been called, the callback timer will be</div><div id="149" class="line none">  149  *             expired and will not call the callback function.</div><div id="150" class="line none">  150  *</div><div id="151" class="line none">  151  */</div><div id="152" class="line none">  152 void ctimer_stop(struct <a href="ctimer.h.html#63">ctimer</a> *c);</div><div id="153" class="line none">  153 </div><div id="154" class="line none">  154 /**</div><div id="155" class="line none">  155  * \brief      Check if a callback timer has expired.</div><div id="156" class="line none">  156  * \param c    A pointer to the callback timer</div><div id="157" class="line none">  157  * \return     True if the timer has expired.</div><div id="158" class="line none">  158  *</div><div id="159" class="line none">  159  *             This function tests if a callback timer has expired and</div><div id="160" class="line none">  160  *             returns true or false depending on its status.</div><div id="161" class="line none">  161  */</div><div id="162" class="line none">  162 bool ctimer_expired(struct <a href="ctimer.h.html#63">ctimer</a> *c);</div><div id="163" class="line none">  163 </div><div id="164" class="line none">  164 /**</div><div id="165" class="line none">  165  * \brief      Initialize the callback timer library.</div><div id="166" class="line none">  166  *</div><div id="167" class="line none">  167  *             This function initializes the callback timer library and</div><div id="168" class="line none">  168  *             should be called from the system boot up code.</div><div id="169" class="line none">  169  */</div><div id="170" class="line none">  170 void ctimer_init(void);</div><div id="171" class="line none">  171 </div><div id="172" class="line none">  172 #endif /* CTIMER_H_ */</div><div id="173" class="line none">  173 /** @} */</div><div id="174" class="line none">  174 /** @} */</div>
</div>
</body>
</html>
