
<html>
<head>
<title>os/net/ipv6/uip-icmp6.h</title>
<link rel="stylesheet" type="text/css" href="../../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 /*</div><div id="2" class="line none">    2  * Copyright (c) 2006, Swedish Institute of Computer Science.</div><div id="3" class="line none">    3  * All rights reserved.</div><div id="4" class="line none">    4  *</div><div id="5" class="line none">    5  * Redistribution and use in source and binary forms, with or without</div><div id="6" class="line none">    6  * modification, are permitted provided that the following conditions</div><div id="7" class="line none">    7  * are met:</div><div id="8" class="line none">    8  * 1. Redistributions of source code must retain the above copyright</div><div id="9" class="line none">    9  *    notice, this list of conditions and the following disclaimer.</div><div id="10" class="line none">   10  * 2. Redistributions in binary form must reproduce the above copyright</div><div id="11" class="line none">   11  *    notice, this list of conditions and the following disclaimer in the</div><div id="12" class="line none">   12  *    documentation and/or other materials provided with the distribution.</div><div id="13" class="line none">   13  * 3. Neither the name of the Institute nor the names of its contributors</div><div id="14" class="line none">   14  *    may be used to endorse or promote products derived from this software</div><div id="15" class="line none">   15  *    without specific prior written permission.</div><div id="16" class="line none">   16  *</div><div id="17" class="line none">   17  * THIS SOFTWARE IS PROVIDED BY THE INSTITUTE AND CONTRIBUTORS ``AS IS'' AND</div><div id="18" class="line none">   18  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</div><div id="19" class="line none">   19  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</div><div id="20" class="line none">   20  * ARE DISCLAIMED.  IN NO EVENT SHALL THE INSTITUTE OR CONTRIBUTORS BE LIABLE</div><div id="21" class="line none">   21  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</div><div id="22" class="line none">   22  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS</div><div id="23" class="line none">   23  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</div><div id="24" class="line none">   24  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</div><div id="25" class="line none">   25  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</div><div id="26" class="line none">   26  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</div><div id="27" class="line none">   27  * SUCH DAMAGE.</div><div id="28" class="line none">   28  *</div><div id="29" class="line none">   29  * This file is part of the Contiki operating system.</div><div id="30" class="line none">   30  *</div><div id="31" class="line none">   31  */</div><div id="32" class="line none">   32 </div><div id="33" class="line none">   33 /**</div><div id="34" class="line none">   34  * \addtogroup uip</div><div id="35" class="line none">   35  * @{</div><div id="36" class="line none">   36  */</div><div id="37" class="line none">   37 </div><div id="38" class="line none">   38 /**</div><div id="39" class="line none">   39  * \file</div><div id="40" class="line none">   40  *    Header file for ICMPv6 message and error handing (RFC 4443)</div><div id="41" class="line none">   41  * \author Julien Abeille &lt;jabeille@cisco.com&gt;</div><div id="42" class="line none">   42  * \author Mathilde Durvy &lt;mdurvy@cisco.com&gt;</div><div id="43" class="line none">   43  */</div><div id="44" class="line none">   44 </div><div id="45" class="line none">   45 #ifndef <a href="uip-icmp6.h.html#46">ICMP6_H_</a></div><div id="46" class="line none">   46 #define <a href="uip-icmp6.h.html#46">ICMP6_H_</a></div><div id="47" class="line none">   47 </div><div id="48" class="line none">   48 #include "net/ipv6/uip.h"</div><div id="49" class="line none">   49 </div><div id="50" class="line none">   50 </div><div id="51" class="line none">   51 /** \name ICMPv6 message types */</div><div id="52" class="line none">   52 /** @{ */</div><div id="53" class="line none">   53 #define <a href="uip-icmp6.h.html#53">ICMP6_DST_UNREACH</a>                 1     /**&lt; dest unreachable */</div><div id="54" class="line none">   54 #define <a href="uip-icmp6.h.html#54">ICMP6_PACKET_TOO_BIG</a>                2   /**&lt; packet too big */</div><div id="55" class="line none">   55 #define <a href="uip-icmp6.h.html#55">ICMP6_TIME_EXCEEDED</a>                   3 /**&lt; time exceeded */</div><div id="56" class="line none">   56 #define <a href="uip-icmp6.h.html#56">ICMP6_PARAM_PROB</a>                        4       /**&lt; ip6 header bad */</div><div id="57" class="line none">   57 #define <a href="uip-icmp6.h.html#57">ICMP6_ECHO_REQUEST</a>              128  /**&lt; Echo request */</div><div id="58" class="line none">   58 #define <a href="uip-icmp6.h.html#58">ICMP6_ECHO_REPLY</a>                129  /**&lt; Echo reply */</div><div id="59" class="line none">   59 </div><div id="60" class="line none">   60 #define <a href="uip-icmp6.h.html#60">ICMP6_RS</a>                        133  /**&lt; Router Solicitation */</div><div id="61" class="line none">   61 #define <a href="uip-icmp6.h.html#61">ICMP6_RA</a>                        134  /**&lt; Router Advertisement */</div><div id="62" class="line none">   62 #define <a href="uip-icmp6.h.html#62">ICMP6_NS</a>                        135  /**&lt; Neighbor Solicitation */</div><div id="63" class="line none">   63 #define <a href="uip-icmp6.h.html#63">ICMP6_NA</a>                        136  /**&lt; Neighbor advertisement */</div><div id="64" class="line none">   64 #define <a href="uip-icmp6.h.html#64">ICMP6_REDIRECT</a>                  137  /**&lt; Redirect */</div><div id="65" class="line none">   65 </div><div id="66" class="line none">   66 #define <a href="uip-icmp6.h.html#66">ICMP6_RPL</a>                       155  /**&lt; RPL */</div><div id="67" class="line none">   67 #define <a href="uip-icmp6.h.html#67">ICMP6_MPL</a>                       159  /**&lt; MPL */</div><div id="68" class="line none">   68 #define <a href="uip-icmp6.h.html#68">ICMP6_PRIV_EXP_100</a>              100  /**&lt; Private Experimentation */</div><div id="69" class="line none">   69 #define <a href="uip-icmp6.h.html#69">ICMP6_PRIV_EXP_101</a>              101  /**&lt; Private Experimentation */</div><div id="70" class="line none">   70 #define <a href="uip-icmp6.h.html#70">ICMP6_PRIV_EXP_200</a>              200  /**&lt; Private Experimentation */</div><div id="71" class="line none">   71 #define <a href="uip-icmp6.h.html#71">ICMP6_PRIV_EXP_201</a>              201  /**&lt; Private Experimentation */</div><div id="72" class="line none">   72 #define <a href="uip-icmp6.h.html#72">ICMP6_ROLL_TM</a>    <a href="uip-icmp6.h.html#70">ICMP6_PRIV_EXP_200</a>  /**&lt; ROLL Trickle Multicast */</div><div id="73" class="line none">   73 #define <a href="uip-icmp6.h.html#73">ICMP6_ESMRF</a>      <a href="uip-icmp6.h.html#71">ICMP6_PRIV_EXP_201</a>  /**&lt; ESMRF Multicast */</div><div id="74" class="line none">   74 /** @} */</div><div id="75" class="line none">   75 </div><div id="76" class="line none">   76 </div><div id="77" class="line none">   77 /** \name ICMPv6 Destination Unreachable message codes*/</div><div id="78" class="line none">   78 /** @{ */</div><div id="79" class="line none">   79 #define <a href="uip-icmp6.h.html#79">ICMP6_DST_UNREACH_NOROUTE</a>         0 /**&lt; no route to destination */</div><div id="80" class="line none">   80 #define <a href="uip-icmp6.h.html#80">ICMP6_DST_UNREACH_ADMIN</a>           1 /**&lt; administratively prohibited */</div><div id="81" class="line none">   81 #define <a href="uip-icmp6.h.html#81">ICMP6_DST_UNREACH_NOTNEIGHBOR</a>     2 /**&lt; not a neighbor(obsolete) */</div><div id="82" class="line none">   82 #define <a href="uip-icmp6.h.html#82">ICMP6_DST_UNREACH_BEYONDSCOPE</a>     2 /**&lt; beyond scope of source address */</div><div id="83" class="line none">   83 #define <a href="uip-icmp6.h.html#83">ICMP6_DST_UNREACH_ADDR</a>            3 /**&lt; address unreachable */</div><div id="84" class="line none">   84 #define <a href="uip-icmp6.h.html#84">ICMP6_DST_UNREACH_NOPORT</a>          4 /**&lt; port unreachable */</div><div id="85" class="line none">   85 /** @} */</div><div id="86" class="line none">   86 </div><div id="87" class="line none">   87 /** \name ICMPv6 Time Exceeded message codes*/</div><div id="88" class="line none">   88 /** @{ */</div><div id="89" class="line none">   89 #define <a href="uip-icmp6.h.html#89">ICMP6_TIME_EXCEED_TRANSIT</a>         0 /**&lt; ttl==0 in transit */</div><div id="90" class="line none">   90 #define <a href="uip-icmp6.h.html#90">ICMP6_TIME_EXCEED_REASSEMBLY</a>      1 /**&lt; ttl==0 in reass */</div><div id="91" class="line none">   91 /** @} */</div><div id="92" class="line none">   92 </div><div id="93" class="line none">   93 /** \name ICMPv6 Parameter Problem message codes*/</div><div id="94" class="line none">   94 /** @{ */</div><div id="95" class="line none">   95 #define <a href="uip-icmp6.h.html#95">ICMP6_PARAMPROB_HEADER</a>            0 /**&lt; erroneous header field */</div><div id="96" class="line none">   96 #define <a href="uip-icmp6.h.html#96">ICMP6_PARAMPROB_NEXTHEADER</a>        1 /**&lt; unrecognized next header */</div><div id="97" class="line none">   97 #define <a href="uip-icmp6.h.html#97">ICMP6_PARAMPROB_OPTION</a>            2 /**&lt; unrecognized option */</div><div id="98" class="line none">   98 /** @} */</div><div id="99" class="line none">   99 </div><div id="100" class="line none">  100 /** \brief Echo Request constant part length */</div><div id="101" class="line none">  101 #define <a href="uip-icmp6.h.html#101">UIP_ICMP6_ECHO_REQUEST_LEN</a>        4</div><div id="102" class="line none">  102 </div><div id="103" class="line none">  103 /** \brief ICMPv6 Error message constant part length */</div><div id="104" class="line none">  104 #define <a href="uip-icmp6.h.html#104">UIP_ICMP6_ERROR_LEN</a>               4</div><div id="105" class="line none">  105 </div><div id="106" class="line none">  106 /** \brief ICMPv6 Error message constant part */</div><div id="107" class="line none">  107 typedef struct <a href="uip-icmp6.h.html#107">uip_icmp6_error</a>{</div><div id="108" class="line none">  108   uint32_t <a href="uip-icmp6.h.html#108">param</a>;</div><div id="109" class="line none">  109 } <a href="uip-icmp6.h.html#107">uip_icmp6_error</a>;</div><div id="110" class="line none">  110 </div><div id="111" class="line none">  111 /** \name ICMPv6 RFC4443 Message processing and sending */</div><div id="112" class="line none">  112 /** @{ */</div><div id="113" class="line none">  113 /**</div><div id="114" class="line none">  114  * \brief Send an icmpv6 error message</div><div id="115" class="line none">  115  * \param type type of the error message</div><div id="116" class="line none">  116  * \param code of the error message</div><div id="117" class="line none">  117  * \param param 32 bit parameter of the error message, semantic depends on error</div><div id="118" class="line none">  118  */</div><div id="119" class="line none">  119 void</div><div id="120" class="line none">  120 uip_icmp6_error_output(uint8_t <a href="uip-ds6.h.html#209">type</a>, uint8_t code, uint32_t <a href="uip-icmp6.h.html#108">param</a>);</div><div id="121" class="line none">  121 </div><div id="122" class="line none">  122 /**</div><div id="123" class="line none">  123  * \brief Send an icmpv6 message</div><div id="124" class="line none">  124  * \param dest destination address of the message</div><div id="125" class="line none">  125  * \param type type of the message</div><div id="126" class="line none">  126  * \param code of the message</div><div id="127" class="line none">  127  * \param payload_len length of the payload</div><div id="128" class="line none">  128  */</div><div id="129" class="line none">  129 void</div><div id="130" class="line none">  130 uip_icmp6_send(const <a href="uip.h.html#105">uip_ipaddr_t</a> *<a href="uip.h.html#1427">dest</a>, int <a href="uip-ds6.h.html#209">type</a>, int code, int payload_len);</div><div id="131" class="line none">  131 </div><div id="132" class="line none">  132 </div><div id="133" class="line none">  133 </div><div id="134" class="line none">  134 typedef void (* <a href="uip-icmp6.h.html#134">uip_icmp6_echo_reply_callback_t</a>)(<a href="uip.h.html#105">uip_ipaddr_t</a> *source,</div><div id="135" class="line none">  135                                                  uint8_t <a href="uip.h.html#1313">ttl</a>,</div><div id="136" class="line none">  136                                                  uint8_t *<a href="../nbr-table.h.html#87">data</a>,</div><div id="137" class="line none">  137                                                  uint16_t datalen);</div><div id="138" class="line none">  138 struct <a href="uip-icmp6.h.html#138">uip_icmp6_echo_reply_notification</a> {</div><div id="139" class="line none">  139   struct <a href="uip-icmp6.h.html#138">uip_icmp6_echo_reply_notification</a> *<a href="uip-ds6-nbr.h.html#107">next</a>;</div><div id="140" class="line none">  140   <a href="uip-icmp6.h.html#134">uip_icmp6_echo_reply_callback_t</a> <a href="uip-icmp6.h.html#140">callback</a>;</div><div id="141" class="line none">  141 };</div><div id="142" class="line none">  142 </div><div id="143" class="line none">  143 /**</div><div id="144" class="line none">  144  * \brief      Add a callback function for ping replies</div><div id="145" class="line none">  145  * \param n    A struct uip_icmp6_echo_reply_notification that must have been allocated by the caller</div><div id="146" class="line none">  146  * \param c    A pointer to the callback function to be called</div><div id="147" class="line none">  147  *</div><div id="148" class="line none">  148  *             This function adds a callback function to the list of</div><div id="149" class="line none">  149  *             callback functions that are called when an ICMP echo</div><div id="150" class="line none">  150  *             reply (ping reply) is received. This is used when</div><div id="151" class="line none">  151  *             implementing a ping protocol: attach a callback</div><div id="152" class="line none">  152  *             function to the ping reply, then send out a ping packet</div><div id="153" class="line none">  153  *             with uip_icmp6_send().</div><div id="154" class="line none">  154  *</div><div id="155" class="line none">  155  *             The caller must have statically allocated a struct</div><div id="156" class="line none">  156  *             uip_icmp6_echo_reply_notification to hold the internal</div><div id="157" class="line none">  157  *             state of the callback function.</div><div id="158" class="line none">  158  *</div><div id="159" class="line none">  159  *             When a ping reply packet is received, all registered</div><div id="160" class="line none">  160  *             callback functions are called. The callback functions</div><div id="161" class="line none">  161  *             must not modify the contents of the uIP buffer.</div><div id="162" class="line none">  162  */</div><div id="163" class="line none">  163 void</div><div id="164" class="line none">  164 uip_icmp6_echo_reply_callback_add(struct <a href="uip-icmp6.h.html#138">uip_icmp6_echo_reply_notification</a> *n,</div><div id="165" class="line none">  165                                   <a href="uip-icmp6.h.html#134">uip_icmp6_echo_reply_callback_t</a> c);</div><div id="166" class="line none">  166 </div><div id="167" class="line none">  167 /**</div><div id="168" class="line none">  168  * \brief      Remove a callback function for ping replies</div><div id="169" class="line none">  169  * \param n    A struct uip_icmp6_echo_reply_notification that must have been previously added with uip_icmp6_echo_reply_callback_add()</div><div id="170" class="line none">  170  *</div><div id="171" class="line none">  171  *             This function removes a callback function from the list of</div><div id="172" class="line none">  172  *             callback functions that are called when an ICMP echo</div><div id="173" class="line none">  173  *             reply (ping reply) is received.</div><div id="174" class="line none">  174  */</div><div id="175" class="line none">  175 void</div><div id="176" class="line none">  176 uip_icmp6_echo_reply_callback_rm(struct <a href="uip-icmp6.h.html#138">uip_icmp6_echo_reply_notification</a> *n);</div><div id="177" class="line none">  177 </div><div id="178" class="line none">  178 /* Generic ICMPv6 input handers */</div><div id="179" class="line none">  179 typedef struct <a href="uip-icmp6.h.html#179">uip_icmp6_input_handler</a> {</div><div id="180" class="line none">  180   struct <a href="uip-icmp6.h.html#179">uip_icmp6_input_handler</a> *<a href="uip-ds6-nbr.h.html#107">next</a>;</div><div id="181" class="line none">  181   void (*<a href="uip-icmp6.h.html#181">handler</a>)(void);</div><div id="182" class="line none">  182   uint8_t <a href="uip-ds6.h.html#209">type</a>;</div><div id="183" class="line none">  183   uint8_t <a href="uip-icmp6.h.html#183">icode</a>;</div><div id="184" class="line none">  184 } <a href="uip-icmp6.h.html#184">uip_icmp6_input_handler_t</a>;</div><div id="185" class="line none">  185 </div><div id="186" class="line none">  186 #define <a href="uip-icmp6.h.html#186">UIP_ICMP6_INPUT_SUCCESS</a>     0</div><div id="187" class="line none">  187 #define <a href="uip-icmp6.h.html#187">UIP_ICMP6_INPUT_ERROR</a>       1</div><div id="188" class="line none">  188 </div><div id="189" class="line none">  189 #define <a href="uip-icmp6.h.html#189">UIP_ICMP6_HANDLER_CODE_ANY</a> 0xFF /* Handle all codes for this type */</div><div id="190" class="line none">  190 </div><div id="191" class="line none">  191 /*</div><div id="192" class="line none">  192  * Initialise a variable of type uip_icmp6_input_handler, to be used later as</div><div id="193" class="line none">  193  * the argument to uip_icmp6_register_input_handler</div><div id="194" class="line none">  194  *</div><div id="195" class="line none">  195  * The function pointer stored in this variable will get called and will be</div><div id="196" class="line none">  196  * expected to handle incoming ICMPv6 datagrams of the specified type/code</div><div id="197" class="line none">  197  *</div><div id="198" class="line none">  198  * If code has a value of UIP_ICMP6_HANDLER_CODE_ANY, the same function</div><div id="199" class="line none">  199  * will handle all codes for this type. In other words, the ICMPv6</div><div id="200" class="line none">  200  * message's code is "don't care"</div><div id="201" class="line none">  201  */</div><div id="202" class="line none">  202 #define <a href="uip-icmp6.h.html#202">UIP_ICMP6_HANDLER</a>(<a href="../../sys/log.h.html#104">name</a>, <a href="uip-ds6.h.html#209">type</a>, code, func) \</div><div id="203" class="line none">  203   static <a href="uip-icmp6.h.html#184">uip_icmp6_input_handler_t</a> <a href="../../sys/log.h.html#104">name</a> = { NULL, func, <a href="uip-ds6.h.html#209">type</a>, code }</div><div id="204" class="line none">  204 </div><div id="205" class="line none">  205 /**</div><div id="206" class="line none">  206  * \brief Handle an incoming ICMPv6 message</div><div id="207" class="line none">  207  * \param type The ICMPv6 message type</div><div id="208" class="line none">  208  * \param icode The ICMPv6 message code</div><div id="209" class="line none">  209  * \return Success: UIP_ICMP6_INPUT_SUCCESS, Error: UIP_ICMP6_INPUT_ERROR</div><div id="210" class="line none">  210  *</div><div id="211" class="line none">  211  * Generic handler for unknown ICMPv6 types. It will lookup for a registered</div><div id="212" class="line none">  212  * function capable of handing this message type. The function must have first</div><div id="213" class="line none">  213  * been registered with uip_icmp6_register_input_handler. The function is in</div><div id="214" class="line none">  214  * charge of setting uip_len to 0, otherwise the uIPv6 core will attempt to</div><div id="215" class="line none">  215  * send whatever remains in the UIP_IP_BUF.</div><div id="216" class="line none">  216  *</div><div id="217" class="line none">  217  * A return value of UIP_ICMP6_INPUT_ERROR means that a handler could not be</div><div id="218" class="line none">  218  * invoked. This is most likely because the ICMPv6 type does not have a valid</div><div id="219" class="line none">  219  * handler associated with it.</div><div id="220" class="line none">  220 </div><div id="221" class="line none">  221  * UIP_ICMP6_INPUT_SUCCESS signifies that a handler was found for this ICMPv6</div><div id="222" class="line none">  222  * type and that it was invoked. It does NOT provide any indication whatsoever</div><div id="223" class="line none">  223  * regarding whether the handler itself succeeded.</div><div id="224" class="line none">  224  */</div><div id="225" class="line none">  225 uint8_t uip_icmp6_input(uint8_t <a href="uip-ds6.h.html#209">type</a>, uint8_t <a href="uip-icmp6.h.html#183">icode</a>);</div><div id="226" class="line none">  226 </div><div id="227" class="line none">  227 /**</div><div id="228" class="line none">  228  * \brief Register a handler which can handle a specific ICMPv6 message type</div><div id="229" class="line none">  229  * \param handler A pointer to the handler</div><div id="230" class="line none">  230  */</div><div id="231" class="line none">  231 void <a href="uip-icmp6.h.html#231">uip_icmp6_register_input_handler</a>(<a href="uip-icmp6.h.html#184">uip_icmp6_input_handler_t</a> *<a href="uip-icmp6.h.html#181">handler</a>);</div><div id="232" class="line none">  232 </div><div id="233" class="line none">  233 </div><div id="234" class="line none">  234 /**</div><div id="235" class="line none">  235  * \brief Initialise the uIP ICMPv6 core</div><div id="236" class="line none">  236  */</div><div id="237" class="line none">  237 void uip_icmp6_init(void);</div><div id="238" class="line none">  238 </div><div id="239" class="line none">  239 /** @} */</div><div id="240" class="line none">  240 </div><div id="241" class="line none">  241 #endif /*ICMP6_H_*/</div><div id="242" class="line none">  242 /** @} */</div>
</div>
</body>
</html>
